local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local ageButton = script.Parent:WaitForChild("AgeTo50Button")
local progressText = script.Parent:WaitForChild("ProgressText")

local TARGET_AGE = 50
local DURATION_SECONDS = 5 * 60 -- 5 minutes

local holdingButton = false
local elapsedTime = 0

local function getHeldPet()
    local player = game.Players.LocalPlayer
    local character = player.Character
    if not character then return nil end
    return character:FindFirstChild("HeldPet")
end

local function getPetAgeValue(pet)
    if not pet then return nil end
    local ageValue = pet:FindFirstChild("Age")
    if ageValue and ageValue:IsA("NumberValue") then
        return ageValue
    end
    return nil
end

local function onButtonPressed()
    local pet = getHeldPet()
    if not pet then
        progressText.Text = "No held pet detected."
        return
    end

    local ageValue = getPetAgeValue(pet)
    if not ageValue then
        progressText.Text = "Pet has no Age value."
        return
    end

    if ageValue.Value >= TARGET_AGE then
        progressText.Text = "Pet is already age 50 or older."
        return
    end

    holdingButton = true
    elapsedTime = 0
    progressText.Text = "Loading: 0%"

    local startAge = ageValue.Value
    local totalSteps = TARGET_AGE - startAge
    local lastStep = startAge

    local connection
    connection = RunService.Heartbeat:Connect(function(deltaTime)
        if not holdingButton then
            connection:Disconnect()
            return
        end

        elapsedTime = elapsedTime + deltaTime
        local progress = math.clamp(elapsedTime / DURATION_SECONDS, 0, 1)
        progressText.Text = string.format("Loading: %d%%", math.floor(progress * 100))

        local expectedAge = startAge + math.floor(totalSteps * progress)

        if expectedAge > lastStep then
            ageValue.Value = expectedAge
            lastStep = expectedAge
        end

        if progress >= 1 then
            holdingButton = false
            progressText.Text = "Done! Pet is now age 50."
            connection:Disconnect()
        end
    end)
end

local function onButtonReleased()
    holdingButton = false
    progressText.Text = "Loading stopped."
end

ageButton.MouseButton1Down:Connect(onButtonPressed)
ageButton.MouseButton1Up:Connect(onButtonReleased)
ageButton.MouseLeave:Connect(onButtonReleased)

progressText.Text = ""
