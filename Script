-- ‚úÖ Fixed Pet Aging GUI + ESP (v1566 compatible)

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- PLAYER
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- GUI SETUP
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "PetAgeGUI"
screenGui.ResetOnSpawn = false

-- BUTTON
local ageButton = Instance.new("TextButton")
ageButton.Parent = screenGui
ageButton.Size = UDim2.new(0, 140, 0, 50)
ageButton.Position = UDim2.new(1, -160, 0.5, -25)
ageButton.AnchorPoint = Vector2.new(0.5, 0.5)
ageButton.Text = "üïí Age Pet"
ageButton.TextScaled = true
ageButton.BackgroundColor3 = Color3.fromRGB(60, 200, 80)
ageButton.TextColor3 = Color3.new(1,1,1)
ageButton.BorderSizePixel = 0
ageButton.ZIndex = 10

-- STATUS LABEL
local statusLabel = Instance.new("TextLabel")
statusLabel.Parent = screenGui
statusLabel.Size = UDim2.new(0, 250, 0, 40)
statusLabel.Position = UDim2.new(1, -160, 0.5, 35)
statusLabel.AnchorPoint = Vector2.new(0.5, 0)
statusLabel.Text = "Waiting..."
statusLabel.TextScaled = true
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.new(1,1,1)

-- ‚úÖ FIXED: FIND PET FUNCTION
local function getHeldPet()
	local petCandidates = {}

	-- Check if any model in character looks like a pet (has Age value + Handle/Tag)
	for _, obj in ipairs(character:GetChildren()) do
		if obj:IsA("Model") and obj:FindFirstChild("Age") and (obj:FindFirstChild("NameTag") or obj:FindFirstChildWhichIsA("Part")) then
			table.insert(petCandidates, obj)
		elseif obj:IsA("Tool") and obj:FindFirstChild("Handle") then
			table.insert(petCandidates, obj)
		end
	end

	if #petCandidates > 0 then
		return petCandidates[1] -- Return first valid one
	end

	return nil
end

-- AGING LOOP
local aging = false
local function startAging()
	if aging then return end
	aging = true

	while aging do
		local pet = getHeldPet()
		if pet then
			local ageValue = pet:FindFirstChild("Age")
			if ageValue and ageValue:IsA("NumberValue") then
				ageValue.Value += 1
				statusLabel.Text = pet.Name .. " [Age: " .. ageValue.Value .. "] ‚úÖ"
			else
				statusLabel.Text = "‚ö†Ô∏è Pet found but missing valid 'Age'"
			end
		else
			statusLabel.Text = "‚ùå No pet held!"
		end
		task.wait(1)
	end
end

-- STOP AGING (optional toggle)
local function stopAging()
	aging = false
	statusLabel.Text = "‚èπÔ∏è Stopped aging."
end

-- BUTTON CLICK
ageButton.MouseButton1Click:Connect(function()
	if not aging then
		statusLabel.Text = "‚è≥ Aging started..."
		startAging()
	else
		stopAging()
	end
end)

-- ‚úÖ LIVE ESP FUNCTION
local function showESP(pet)
	if not pet or not pet:IsDescendantOf(workspace) then return end

	local existing = pet:FindFirstChild("ESP")
	if existing then return end

	local headPart = pet:FindFirstChild("Head") or pet:FindFirstChildWhichIsA("BasePart")
	if not headPart then return end

	local billboard = Instance.new("BillboardGui", pet)
	billboard.Name = "ESP"
	billboard.Size = UDim2.new(0, 120, 0, 40)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.AlwaysOnTop = true
	billboard.Adornee = headPart

	local label = Instance.new("TextLabel", billboard)
	label.Name = "Text"
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.TextScaled = true
	label.TextColor3 = Color3.new(1, 1, 0)
	label.Font = Enum.Font.Gotham
	label.Text = "Age: ?"

	RunService.RenderStepped:Connect(function()
		if pet and pet:FindFirstChild("Age") then
			label.Text = pet.Name .. "\nAge: " .. tostring(pet.Age.Value)
		else
			label.Text = "No Age Info"
		end
	end)
end

-- üü° Auto apply ESP to pet when detected
RunService.Heartbeat:Connect(function()
	local heldPet = getHeldPet()
	if heldPet and not heldPet:FindFirstChild("ESP") then
		showESP(heldPet)
	end
end)
